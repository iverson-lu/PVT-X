<Window x:Class="PcTest.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="PC Test System" Height="900" Width="1400"
        Loaded="OnLoaded">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="2*"/>
        </Grid.RowDefinitions>
        <TextBlock Text="PC Test System" FontSize="24" FontWeight="Bold" />

        <Grid Grid.Row="1" Margin="0,12,0,12">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Vertical" Margin="0,0,12,0">
                <TextBlock Text="Test Root" FontWeight="SemiBold"/>
                <TextBox Text="{Binding TestRoot, UpdateSourceTrigger=PropertyChanged}" MinWidth="400"/>
            </StackPanel>
            <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Vertical">
                <TextBlock Text="Runs Root" FontWeight="SemiBold"/>
                <TextBox Text="{Binding RunsRoot, UpdateSourceTrigger=PropertyChanged}" MinWidth="300"/>
            </StackPanel>
            <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,8,12,0">
                <Button Content="Discover Tests" Command="{Binding DiscoverCommand}" Padding="10,6" Margin="0,0,8,0"/>
                <Button Content="Refresh History" Command="{Binding RefreshHistoryCommand}" Padding="10,6"/>
            </StackPanel>
            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding StatusMessage}" TextWrapping="Wrap" VerticalAlignment="Center" Margin="12,8,0,0"/>
        </Grid>

        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>
            <Border BorderBrush="#DDD" BorderThickness="1" Padding="8" CornerRadius="4">
                <DockPanel>
                    <TextBlock Text="Tests" FontSize="16" FontWeight="Bold" DockPanel.Dock="Top" Margin="0,0,0,8"/>
                    <ListBox ItemsSource="{Binding Tests}" SelectedItem="{Binding SelectedTest}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Id}" FontSize="12" Foreground="Gray"/>
                                    <TextBlock Text="{Binding Category}" FontSize="12"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>

            <Border Grid.Column="1" BorderBrush="#DDD" BorderThickness="1" Padding="8" CornerRadius="4" Margin="12,0,0,0">
                <ScrollViewer>
                    <StackPanel>
                        <TextBlock Text="{Binding SelectedTest.Name}" FontSize="18" FontWeight="Bold"/>
                        <TextBlock Text="{Binding SelectedTest.Id}" Foreground="Gray" Margin="0,2,0,0"/>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="{Binding SelectedTest.Category}" FontWeight="SemiBold" Margin="0,0,8,0"/>
                            <TextBlock Text="|" Margin="0,0,8,0" />
                            <TextBlock Text="{Binding SelectedTest.Version}" Margin="0,0,8,0" />
                            <TextBlock Text="|" Margin="0,0,8,0" />
                            <TextBlock Text="{Binding SelectedTest.Privilege}" />
                        </StackPanel>
                        <TextBlock Text="{Binding SelectedTest.Description}" TextWrapping="Wrap" Margin="0,4,0,8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Timeout:" FontWeight="SemiBold" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding SelectedTest.TimeoutSec}" Margin="0,0,12,0"/>
                            <TextBlock Text="Tags:" FontWeight="SemiBold" Margin="0,0,8,0"/>
                            <ItemsControl ItemsSource="{Binding SelectedTest.Tags}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#EEE" Padding="4,2" CornerRadius="3" Margin="0,0,4,0">
                                            <TextBlock Text="{Binding}" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </StackPanel>

                        <TextBlock Text="Parameters" FontSize="16" FontWeight="Bold" Margin="0,8,0,4"/>
                        <ItemsControl ItemsSource="{Binding Parameters}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,0,0,8">
                                        <TextBlock Text="{Binding Label}" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Hint}" FontSize="11" Foreground="Gray"/>
                                        <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}" />
                                        <TextBlock Text="{Binding Definition.Help}" FontSize="11" Foreground="DarkSlateGray" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Run" Command="{Binding RunCommand}" Padding="12,6" Margin="0,0,8,0" />
                            <Button Content="Cancel" Command="{Binding CancelCommand}" Padding="12,6" />
                        </StackPanel>

                        <Border BorderBrush="#EEE" BorderThickness="1" Padding="8" Margin="0,8,0,0" CornerRadius="4">
                            <StackPanel>
                                <TextBlock Text="Last Result" FontWeight="Bold"/>
                                <TextBlock Text="{Binding LastResultStatus}" />
                                <TextBlock Text="{Binding LastResultMessage}" TextWrapping="Wrap"/>
                                <TextBlock Text="Run Folder:" FontWeight="SemiBold" Margin="0,4,0,0"/>
                                <TextBlock Text="{Binding ActiveRunFolder}" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <Border Grid.Row="3" BorderBrush="#DDD" BorderThickness="1" Padding="8" CornerRadius="4" Margin="0,12,0,0">
            <DockPanel>
                <TextBlock Text="Run History" FontSize="16" FontWeight="Bold" DockPanel.Dock="Top" Margin="0,0,0,8"/>
                <DataGrid ItemsSource="{Binding RunHistory}" AutoGenerateColumns="False" HeadersVisibility="Column" CanUserAddRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Run Id" Binding="{Binding RunId}" Width="2*"/>
                        <DataGridTextColumn Header="Test Id" Binding="{Binding TestId}" Width="*"/>
                        <DataGridTextColumn Header="Start" Binding="{Binding StartTime}" Width="*" />
                        <DataGridTextColumn Header="End" Binding="{Binding EndTime}" Width="*" />
                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="*" />
                        <DataGridTextColumn Header="Folder" Binding="{Binding RunFolder}" Width="2*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>
    </Grid>
</Window>
