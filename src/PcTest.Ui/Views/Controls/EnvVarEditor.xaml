<UserControl x:Class="PcTest.Ui.Views.Controls.EnvVarEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:vm="clr-namespace:PcTest.Ui.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="600"
             d:DataContext="{d:DesignInstance vm:EnvVarEditorViewModel}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="12"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="12"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Action Buttons -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right">
            <ui:Button Content="Add"
                       Icon="{ui:SymbolIcon Add24}"
                       Command="{Binding AddRowCommand}"
                       Appearance="Primary"
                       Height="32"
                       Padding="14,0"
                       Margin="0,0,8,0"/>
            <ui:Button Content="Remove"
                       Icon="{ui:SymbolIcon Delete24}"
                       Command="{Binding RemoveRowCommand}"
                       Style="{StaticResource EnvEditorToolbarButtonStyle}"/>
        </StackPanel>

        <!-- Divider -->
        <Border Grid.Row="2"
                Height="1"
                Background="{DynamicResource BorderSubtleBrush}"/>
        
        <!-- Environment Variables List -->
        <Border Grid.Row="4"
               Style="{StaticResource EnvEditorListContainerStyle}">
            <Grid>
                <!-- List for editing key-value pairs -->
                <ListView ItemsSource="{Binding Items}"
                          SelectedItem="{Binding SelectedItem}"
                          Style="{StaticResource EnvEditorListViewStyle}"
                          ItemContainerStyle="{StaticResource EnvEditorListViewItemStyle}"
                          Grid.IsSharedSizeScope="True">
                    <ListView.ItemTemplate>
                        <DataTemplate DataType="{x:Type vm:EnvVarRowViewModel}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" SharedSizeGroup="EnvKeyColumn"/>
                                    <ColumnDefinition Width="3*" SharedSizeGroup="EnvValueColumn"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBox Grid.Column="0"
                                         Grid.Row="0"
                                         Text="{Binding Key, UpdateSourceTrigger=PropertyChanged}"
                                         Tag="Key"
                                         Margin="0,0,12,0"
                                         Style="{StaticResource EnvEditorKeyTextBoxStyle}"/>
                                
                                <TextBox Grid.Column="1"
                                         Grid.Row="0"
                                         Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                         Tag="Value"
                                         Margin="0,0,12,0"
                                         Style="{StaticResource EnvEditorTextBoxStyle}"/>
                                
                                <ui:Button Grid.Column="2"
                                           Grid.Row="0"
                                           Icon="{ui:SymbolIcon Delete24}"
                                           Command="{Binding DataContext.RemoveRowCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                           CommandParameter="{Binding}"
                                           ToolTip="Remove"
                                           Style="{StaticResource EnvEditorIconButtonStyle}"/>
                                
                                <TextBlock Grid.Column="0"
                                           Grid.Row="1"
                                           Text="{Binding Error}"
                                           Foreground="{DynamicResource StatusErrorBrush}"
                                           FontSize="{StaticResource FontSizeXS}"
                                           Margin="2,4,0,0"
                                           Visibility="{Binding HasError, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
                
                <!-- Empty state message -->
                <TextBlock Text="No environment variables. Click Add to create one."
                          Foreground="{DynamicResource TextTertiaryBrush}"
                          FontSize="{StaticResource FontSizeS}"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Margin="24"
                          TextWrapping="Wrap"
                          TextAlignment="Center">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Items.Count}" Value="0">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</UserControl>
