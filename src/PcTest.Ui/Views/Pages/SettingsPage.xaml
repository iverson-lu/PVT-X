<Page x:Class="PcTest.Ui.Views.Pages.SettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:vm="clr-namespace:PcTest.Ui.ViewModels"
      Title="Settings"
      d:DataContext="{d:DesignInstance vm:SettingsViewModel}"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      Background="{StaticResource SurfaceBackgroundBrush}">
    
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="32,24" MaxWidth="1040" HorizontalAlignment="Center">
            <!-- Page Header -->
            <TextBlock Text="Settings" 
                      Style="{StaticResource PageTitleStyle}" 
                      Margin="0,0,0,24"/>
            
            <!-- Path Configuration Card -->
            <Border Background="{StaticResource CardBackgroundBrush}" 
                    BorderBrush="{StaticResource BorderSubtleBrush}" 
                    BorderThickness="1"
                    CornerRadius="{StaticResource RadiusM}"
                    Padding="20"
                    Margin="0,0,0,16">
                <Border.Effect>
                    <DropShadowEffect Color="#20000000" BlurRadius="8" ShadowDepth="2" Direction="270" Opacity="0.3"/>
                </Border.Effect>
                <StackPanel>
                    <!-- Card Header -->
                    <TextBlock Text="Path Configuration" 
                              Style="{StaticResource SectionTitleStyle}"
                              Margin="0,0,0,20"/>
                    
                    <!-- Assets Root -->
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                  Text="Assets Root" 
                                  VerticalAlignment="Center"
                                  FontSize="{StaticResource FontSizeM}"
                                  Foreground="{StaticResource TextSecondaryBrush}"/>
                        <ui:TextBox Grid.Column="1" 
                                   Text="{Binding AssetsRoot, UpdateSourceTrigger=PropertyChanged}" 
                                   Margin="0,0,8,0"/>
                        <ui:Button Grid.Column="2" 
                                  Icon="{ui:SymbolIcon FolderOpen24}" 
                                  Command="{Binding BrowseAssetsRootCommand}"
                                  ToolTip="Browse..."
                                  Appearance="Secondary"/>
                    </Grid>
                    
                    <!-- Runs Directory -->
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                  Text="Runs Directory" 
                                  VerticalAlignment="Center"
                                  FontSize="{StaticResource FontSizeM}"
                                  Foreground="{StaticResource TextSecondaryBrush}"/>
                        <ui:TextBox Grid.Column="1" 
                                   Text="{Binding RunsDirectory, UpdateSourceTrigger=PropertyChanged}" 
                                   Margin="0,0,8,0"/>
                        <ui:Button Grid.Column="2" 
                                  Icon="{ui:SymbolIcon FolderOpen24}" 
                                  Command="{Binding BrowseRunsDirectoryCommand}"
                                  ToolTip="Browse..."
                                  Appearance="Secondary"/>
                    </Grid>
                    
                    <!-- Runner Executable -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                  Text="Runner Executable" 
                                  VerticalAlignment="Center"
                                  FontSize="{StaticResource FontSizeM}"
                                  Foreground="{StaticResource TextSecondaryBrush}"/>
                        <ui:TextBox Grid.Column="1" 
                                   Text="{Binding RunnerExecutable, UpdateSourceTrigger=PropertyChanged}" 
                                   Margin="0,0,8,0"/>
                        <ui:Button Grid.Column="2" 
                                  Icon="{ui:SymbolIcon FolderOpen24}" 
                                  Command="{Binding BrowseRunnerExecutableCommand}"
                                  ToolTip="Browse..."
                                  Appearance="Secondary"/>
                    </Grid>
                </StackPanel>
            </Border>
            
            <!-- Appearance Card -->
            <Border Background="{StaticResource CardBackgroundBrush}" 
                    BorderBrush="{StaticResource BorderSubtleBrush}" 
                    BorderThickness="1"
                    CornerRadius="{StaticResource RadiusM}"
                    Padding="20"
                    Margin="0,0,0,16">
                <Border.Effect>
                    <DropShadowEffect Color="#20000000" BlurRadius="8" ShadowDepth="2" Direction="270" Opacity="0.3"/>
                </Border.Effect>
                <StackPanel>
                    <!-- Card Header -->
                    <TextBlock Text="Appearance" 
                              Style="{StaticResource SectionTitleStyle}"
                              Margin="0,0,0,20"/>
                    
                    <!-- Theme -->
                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                  Text="Theme" 
                                  VerticalAlignment="Center"
                                  FontSize="{StaticResource FontSizeM}"
                                  Foreground="{StaticResource TextSecondaryBrush}"/>
                        <ComboBox Grid.Column="1" 
                                 ItemsSource="{Binding ThemeOptions}" 
                                 SelectedItem="{Binding SelectedTheme}" 
                                 Width="180" 
                                 HorizontalAlignment="Left"/>
                    </Grid>
                    
                    <!-- Console Window Checkbox -->
                    <StackPanel>
                        <TextBlock Text="Console" 
                                  FontSize="{StaticResource FontSizeS}"
                                  FontWeight="SemiBold"
                                  Foreground="{StaticResource TextTertiaryBrush}"
                                  Margin="0,0,0,8"/>
                        <CheckBox Content="Show console window during execution" 
                                 IsChecked="{Binding ShowConsoleWindow}"
                                 Margin="0,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </Border>
            
            <!-- Execution Card -->
            <Border Background="{StaticResource CardBackgroundBrush}" 
                    BorderBrush="{StaticResource BorderSubtleBrush}" 
                    BorderThickness="1"
                    CornerRadius="{StaticResource RadiusM}"
                    Padding="20"
                    Margin="0,0,0,16">
                <Border.Effect>
                    <DropShadowEffect Color="#20000000" BlurRadius="8" ShadowDepth="2" Direction="270" Opacity="0.3"/>
                </Border.Effect>
                <StackPanel>
                    <!-- Card Header -->
                    <TextBlock Text="Execution" 
                              Style="{StaticResource SectionTitleStyle}"
                              Margin="0,0,0,20"/>
                    
                    <!-- Default Timeout -->
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                  Text="Default Timeout" 
                                  VerticalAlignment="Center"
                                  FontSize="{StaticResource FontSizeM}"
                                  Foreground="{StaticResource TextSecondaryBrush}"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <ui:NumberBox Value="{Binding DefaultTimeout}" 
                                         Width="120" 
                                         Minimum="0" 
                                         Maximum="3600"/>
                            <TextBlock Text="seconds" 
                                      VerticalAlignment="Center" 
                                      FontSize="{StaticResource FontSizeM}"
                                      Foreground="{StaticResource TextTertiaryBrush}"
                                      Margin="12,0,0,0"/>
                        </StackPanel>
                    </Grid>
                    
                    <!-- Max Retry Count -->
                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                  Text="Max Retry Count" 
                                  VerticalAlignment="Center"
                                  FontSize="{StaticResource FontSizeM}"
                                  Foreground="{StaticResource TextSecondaryBrush}"/>
                        <ui:NumberBox Grid.Column="1" 
                                     Value="{Binding MaxRetryCount}" 
                                     Width="120" 
                                     HorizontalAlignment="Left"
                                     Minimum="0" 
                                     Maximum="10"/>
                    </Grid>
                    
                    <!-- Automation Options -->
                    <StackPanel>
                        <TextBlock Text="Automation" 
                                  FontSize="{StaticResource FontSizeS}"
                                  FontWeight="SemiBold"
                                  Foreground="{StaticResource TextTertiaryBrush}"
                                  Margin="0,0,0,8"/>
                        <CheckBox Content="Auto-refresh run history" 
                                 IsChecked="{Binding AutoRefreshHistory}" 
                                 Margin="0,0,0,8"/>
                        <CheckBox Content="Show debug output in console" 
                                 IsChecked="{Binding ShowDebugOutput}"/>
                    </StackPanel>
                </StackPanel>
            </Border>
            
            <!-- Import/Export Card -->
            <Border Background="{StaticResource CardBackgroundBrush}" 
                    BorderBrush="{StaticResource BorderSubtleBrush}" 
                    BorderThickness="1"
                    CornerRadius="{StaticResource RadiusM}"
                    Padding="20"
                    Margin="0,0,0,24">
                <Border.Effect>
                    <DropShadowEffect Color="#20000000" BlurRadius="8" ShadowDepth="2" Direction="270" Opacity="0.3"/>
                </Border.Effect>
                <StackPanel>
                    <!-- Card Header -->
                    <TextBlock Text="Import/Export Settings" 
                              Style="{StaticResource SectionTitleStyle}"
                              Margin="0,0,0,16"/>
                    
                    <!-- Action Buttons -->
                    <StackPanel Orientation="Horizontal">
                        <ui:Button Content="Import Settings" 
                                  Icon="{ui:SymbolIcon ArrowDownload24}"
                                  Command="{Binding ImportSettingsCommand}"
                                  Margin="0,0,12,0"/>
                        <ui:Button Content="Export Settings" 
                                  Icon="{ui:SymbolIcon ArrowUpload24}"
                                  Command="{Binding ExportSettingsCommand}"
                                  Margin="0,0,12,0"/>
                        <ui:Button Content="Reset to Defaults" 
                                  Icon="{ui:SymbolIcon ArrowReset24}"
                                  Command="{Binding ResetSettingsCommand}"
                                  Appearance="Caution"/>
                    </StackPanel>
                </StackPanel>
            </Border>
            
            <!-- Save Button (Outside Cards) -->
            <Grid Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" VerticalAlignment="Center">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Text" Value=""/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding HasUnsavedChanges}" Value="True">
                                    <Setter Property="Text" Value="You have unsaved changes."/>
                                    <Setter Property="Foreground" Value="{StaticResource StatusWarningBrush}"/>
                                    <Setter Property="FontSize" Value="{StaticResource FontSizeM}"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                
                <ui:Button Grid.Column="1" 
                          Content="Save Changes" 
                          Icon="{ui:SymbolIcon Save24}"
                          Command="{Binding SaveCommand}"
                          Appearance="Primary"
                          IsEnabled="{Binding HasUnsavedChanges}"/>
            </Grid>
        </StackPanel>
    </ScrollViewer>
</Page>
